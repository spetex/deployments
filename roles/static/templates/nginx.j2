map $http_origin $origin_allowed {
  default 0;
  https://spetex.cz 1;
  https://www.spetex.cz 1;
}

map $origin_allowed $origin {
  default "";
  1 $http_origin;
}

server {
  server_name {{ hostname }};
  listen 443 ssl http2;
  root {{ app_dir }};

  gzip on;
  gzip_comp_level 2;
  gzip_min_length 1024;
  gzip_types text/plain text/html text/css application/x-javascript text/javascript;

  ssl_certificate /etc/letsencrypt/live/{{ hostname }}/fullchain.pem;
  ssl_certificate_key /etc/letsencrypt/live/{{ hostname }}/privkey.pem;
  include /etc/letsencrypt/options-ssl-nginx.conf;
  ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

  add_header 'Access-Control-Allow-Origin' $origin;
}

server {
  server_name {{ hostname }};
  listen 80;
  if ($host = {{ hostname }}) {
    return 301 https://$host$request_uri;
  }
  return 404;
}
